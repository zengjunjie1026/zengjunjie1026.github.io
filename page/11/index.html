<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zengjunjie1026.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="做自己爱做的事，爱自己在做的事！">
<meta property="og:type" content="website">
<meta property="og:title" content="分子美食家的博客">
<meta property="og:url" content="https://zengjunjie1026.github.io/page/11/index.html">
<meta property="og:site_name" content="分子美食家的博客">
<meta property="og:description" content="做自己爱做的事，爱自己在做的事！">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="andrew">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zengjunjie1026.github.io/page/11/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/11/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>分子美食家的博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">分子美食家的博客</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记录学习的技能和遇到的问题</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">andrew</p>
  <div class="site-description" itemprop="description">做自己爱做的事，爱自己在做的事！</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">74</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zengjunjie1026.github.io/2023/08/16/elasticsearch%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="andrew">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="分子美食家的博客">
      <meta itemprop="description" content="做自己爱做的事，爱自己在做的事！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 分子美食家的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/16/elasticsearch%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">elasticsearch分布式安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-08-16 17:59:44 / 修改时间：21:29:16" itemprop="dateCreated datePublished" datetime="2023-08-16T17:59:44+08:00">2023-08-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zengjunjie1026.github.io/2023/08/16/minio%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="andrew">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="分子美食家的博客">
      <meta itemprop="description" content="做自己爱做的事，爱自己在做的事！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 分子美食家的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/16/minio%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">minio介绍</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-16 17:59:33" itemprop="dateCreated datePublished" datetime="2023-08-16T17:59:33+08:00">2023-08-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-30 10:40:23" itemprop="dateModified" datetime="2023-08-30T10:40:23+08:00">2023-08-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="minio"><a href="#minio" class="headerlink" title="minio"></a>minio</h1><h1 id="文件系统了解及对比选型"><a href="#文件系统了解及对比选型" class="headerlink" title="文件系统了解及对比选型"></a><strong>文件系统了解及对比选型</strong></h1><p><strong>分布式文件系统</strong>（<strong>Distributed file system，DFS</strong>），或是网络文件系统（Network File System），是一种允许文件透过网络在多台主机上分享的文件系统，可让多机器上的多用户分享文件和存储空间。分布式文件系统解决的最大的问题是资源共享的问题，因此分布式文件系统最大的特点是多个客户端可以访问相同的服务端</p>
<h2 id="1-专业名词"><a href="#1-专业名词" class="headerlink" title="#1. 专业名词"></a><strong><a target="_blank" rel="noopener" href="https://note.dolyw.com/fs/00-FS-Select.html#_1-%E4%B8%93%E4%B8%9A%E5%90%8D%E8%AF%8D">#</a>1. 专业名词</strong></h2><table>
<thead>
<tr>
<th>缩写</th>
<th>全称</th>
<th>注释</th>
</tr>
</thead>
<tbody><tr>
<td>SDS</td>
<td>Software Defined Storag</td>
<td>软件定义存储技术</td>
</tr>
<tr>
<td>RAID</td>
<td>Redundant Array of Independent Disk</td>
<td>磁盘阵列技术</td>
</tr>
<tr>
<td>DG</td>
<td>Disk Group</td>
<td>硬盘组</td>
</tr>
<tr>
<td>VD</td>
<td>Virtual Disk</td>
<td>虚拟磁盘（等效磁盘组）</td>
</tr>
<tr>
<td>Mirroring</td>
<td>-</td>
<td>镜像技术，又称为复制技术(Replication)</td>
</tr>
<tr>
<td>Striping</td>
<td>-</td>
<td>条带（可提供并行的数据吞吐能力）</td>
</tr>
<tr>
<td>Erasure Code</td>
<td>-</td>
<td>纠删码（提供高可用性和高速读写能力）</td>
</tr>
<tr>
<td>RADOS</td>
<td>Reliable，Autonomic，Distributed Object Store</td>
<td>可靠的自主的分布式对象存储</td>
</tr>
<tr>
<td>OSD</td>
<td>Object Storage Device</td>
<td>对象存储设备</td>
</tr>
<tr>
<td>MDS</td>
<td>Metadata Server</td>
<td>元数据服务</td>
</tr>
<tr>
<td>MTTR</td>
<td>Mean Time To Restoration</td>
<td>平均恢复时间</td>
</tr>
</tbody></table>
<h2 id="2-存储方式"><a href="#2-存储方式" class="headerlink" title="#2. 存储方式"></a><strong><a target="_blank" rel="noopener" href="https://note.dolyw.com/fs/00-FS-Select.html#_2-%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F">#</a>2. 存储方式</strong></h2><p>块存储、文件存储、对象存储</p>
<h3 id="2-1-块存储"><a href="#2-1-块存储" class="headerlink" title="#2.1. 块存储"></a><strong><a target="_blank" rel="noopener" href="https://note.dolyw.com/fs/00-FS-Select.html#_2-1-%E5%9D%97%E5%AD%98%E5%82%A8">#</a>2.1. 块存储</strong></h3><p>就好比硬盘一样，直接挂在到主机， 一般用于主机的直接存储空间和数据库应用(MySQL)的存储</p>
<p><strong>块存储</strong>(<strong>DAS&#x2F;SAN</strong>)通常应用在某些专有的系统中，这类应用要求很高的随机读写性能和高可靠性，上面搭载的通常是 Oracle&#x2F;DB2 这种传统数据库，连接通常是以 FC 光纤(8Gb&#x2F;16Gb)为主，走光纤协议。如果要求稍低一些，也会出现基于千兆&#x2F;万兆以太网的连接方式，MySQL 这种数据库就可能会使用 IP SAN，走 iSCSI 协议</p>
<p>通常使用<strong>块存储</strong>的都是系统而非用户，并发访问不会很多，经常出现一套存储只服务一个应用系统，例如如交易系统，计费系统。典型行业如金融，制造，能源，电信等</p>
<h3 id="2-2-文件存储"><a href="#2-2-文件存储" class="headerlink" title="#2.2. 文件存储"></a><strong><a target="_blank" rel="noopener" href="https://note.dolyw.com/fs/00-FS-Select.html#_2-2-%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8">#</a>2.2. 文件存储</strong></h3><p><strong>文件存储</strong>(<strong>NAS</strong>)相对来说就更能兼顾多个应用和更多用户访问，同时提供方便的数据共享手段</p>
<p>在 PC 时代，数据共享也大多是用文件的形式，比如常见的的 FTP 服务，NFS 服务，Samba 共享这些都是属于典型的文件存储。几十个用户甚至上百用户的文件存储共享访问都可以用 NAS 存储加以解决</p>
<p>在中小企业市场，一两台 NAS 存储设备就能支撑整个 IT 部门了。CRM 系统，SCM 系统，OA 系统，邮件系统都可以使用 NAS 存储统统搞定。甚至在公有云发展的早几年，用户规模没有上来时，云存储的底层硬件也有用几套 NAS 存储设备就解决的，甚至云主机的镜像也有放在 NAS 存储上的例子</p>
<p><strong>文件存储</strong>的广泛兼容性和易用性，是这类存储的突出特点，但是从性能上来看，相对 SAN 就要低一些。NAS 存储基本上是以太网访问模式，普通千兆网，走 NFS&#x2F;CIFS 协议</p>
<h3 id="2-3-对象存储"><a href="#2-3-对象存储" class="headerlink" title="#2.3. 对象存储"></a><strong><a target="_blank" rel="noopener" href="https://note.dolyw.com/fs/00-FS-Select.html#_2-3-%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8">#</a>2.3. 对象存储</strong></h3><p>前面说到的<strong>块存储</strong>和<strong>文件存储</strong>，基本上都还是在专有的局域网络内部使用，而<strong>对象存储</strong>的优势场景却是互联网或者公网，主要解决海量数据，海量并发访问的需求</p>
<p>基于互联网的应用才是对象存储的主要适配（当然这个条件同样适用于云计算，基于互联网的应用最容易迁移到云上），基本所有成熟的公有云都提供了对象存储产品，不管是国内还是国外</p>
<p><strong>对象存储</strong>常见的适配应用如网盘、媒体娱乐，医疗 PACS，气象，归档等数据量超大而又相对 冷数据 和非在线处理的应用类型，这类应用单个数据大，总量也大，适合对象存储海量和易扩展的特点</p>
<p>网盘类应用也差不多，数据总量很大，另外还有并发访问量也大，支持 10 万级用户访问这种需求就值得单列一个项目了。归档类应用只是数据量大的 冷数据，并发访问的需求倒是不太突出</p>
<p>另外基于移动端的一些新兴应用也是适合的，智能手机和移动互联网普及的情况下，所谓 UGD（用户产生的数据，手机的照片视频）总量和用户数都是很大挑战。毕竟直接使用 HTTP get&#x2F;put 就能直接实现数据存取，对移动应用来说还是有一定吸引力的</p>
<p><strong>对象存储</strong>的访问通常是在互联网，走 HTTP 协议，性能方面，单独看一个连接的是不高的（还要解决掉线断点续传之类的可靠性问题），主要强大的地方是支持的并发数量，聚合起来的性能带宽就非常可观了</p>
<h3 id="2-4-性能对比"><a href="#2-4-性能对比" class="headerlink" title="#2.4. 性能对比"></a><strong><a target="_blank" rel="noopener" href="https://note.dolyw.com/fs/00-FS-Select.html#_2-4-%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94">#</a>2.4. 性能对比</strong></h3><ul>
<li><strong>块存储就像超跑，根本不在意能不能多载几个人，要的就是极限速度和高速下的稳定性和可靠性</strong>，各大厂商出新产品都要去纽北赛道刷个单圈最快纪录，千方百计就为提高一两秒。<strong>块存储容量也不大，TB 这个数量级，支持的应用和适用的环境也比较专业</strong>（FC+Oracle），在乎的都是 IOPS 的性能值</li>
<li><strong>文件存储像集卡，普适各种场合，又能装数据（数百TB），而且兼容性好</strong>，只要你是文件，各种货物都能往里塞，在不超过性能载荷的前提下，能拉动常见的各种系统。标准 POXIS 接口，后车门打开就能装卸。卡车也不挑路，不像块存储非要上赛道才能开，<strong>普通的千兆公路就能畅通无阻</strong>。速度虽然没有块存储超跑那么块，但跑个 80&#x2F;100 码还是稳稳当当</li>
<li><strong>对象存储就像海运货轮，应对的是”真·海量”，几十上百 PB 的数据</strong>，以集装箱 &#x2F;container（桶&#x2F;bucket）为单位码得整整齐齐，里面装满各种对象数据，十万客户发的货（数据），一条船就都处理得过来，<strong>按照键值</strong>（KeyVaule）记得清清楚楚。海运速度慢是慢点，有时候遇到点网络风暴还不稳定，但支持断点续传，最终还是能安全送达的，对大宗货物尤其是非结构化数据，整体上来看是最快捷便利的</li>
</ul>
<h3 id="2-5-访问方式"><a href="#2-5-访问方式" class="headerlink" title="#2.5. 访问方式"></a><strong><a target="_blank" rel="noopener" href="https://note.dolyw.com/fs/00-FS-Select.html#_2-5-%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F">#</a>2.5. 访问方式</strong></h3><ul>
<li><strong>块存储通常都是通过光纤网络连接</strong>，服务器&#x2F;小机上配置 FC 光纤 HBA 卡，通过光纤交换机连接存储（IP SAN 可以通过千兆以太网，以 iSCSI 客户端连接存储），主机端以逻辑卷（Volume）的方式访问。连接成功后，应用访问存储是按起始地址，偏移量 Offset 的方法来访问的</li>
<li><strong>文件存储通常只要是局域网内，千兆&#x2F;百兆的以太网环境皆可</strong>。网线连上，服务器端通过操作系统内置的 NAS 客户端，如 NFS&#x2F;CIFS&#x2F;FTP 客户端挂载存储成为一个本地的文件夹后访问，只要符合 POXIS 标准，应用就可以用标准的 open，seek，write&#x2F;read，close 这些方法对其访问操作</li>
<li><strong>对象存储不在乎网络</strong>，而且它的访问比较有特色，只能存取删（put&#x2F;get&#x2F;delete），不能打开修改存盘。只能取下来改好后上传，去覆盖原对象</li>
</ul>
<h2 id="3-文件系统"><a href="#3-文件系统" class="headerlink" title="#3. 文件系统"></a><strong><a target="_blank" rel="noopener" href="https://note.dolyw.com/fs/00-FS-Select.html#_3-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F">#</a>3. 文件系统</strong></h2><p>开源分布式存储系统对比，还有很多其他，这里只列举这几款</p>
<table>
<thead>
<tr>
<th>存储系统</th>
<th>Ceph</th>
<th>Swift</th>
<th>HDFS</th>
<th>FastDFS</th>
<th>Ambry</th>
<th>MinIO</th>
</tr>
</thead>
<tbody><tr>
<td>开发语言</td>
<td>C++</td>
<td>Python</td>
<td>Java</td>
<td>C</td>
<td>Java</td>
<td>Go</td>
</tr>
<tr>
<td>开源协议</td>
<td>LGPL</td>
<td>Apache</td>
<td>Apache</td>
<td>GPL3</td>
<td>Apache</td>
<td>Apache</td>
</tr>
<tr>
<td>存储方式</td>
<td>对象&#x2F;文件&#x2F;块</td>
<td>对象</td>
<td>文件</td>
<td>文件&#x2F;块</td>
<td>对象</td>
<td>对象</td>
</tr>
<tr>
<td>在线扩容</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>-</td>
</tr>
<tr>
<td>冗余备份</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>-</td>
</tr>
<tr>
<td>单点故障</td>
<td>不存在</td>
<td>不存在</td>
<td>存在</td>
<td>不存在</td>
<td>不存在</td>
<td>-</td>
</tr>
<tr>
<td>易用性</td>
<td>一般</td>
<td>一般</td>
<td>一般</td>
<td>简单</td>
<td>简单</td>
<td>简单</td>
</tr>
<tr>
<td>跨集群</td>
<td>不支持</td>
<td>-</td>
<td>不支持</td>
<td>部分支持</td>
<td>不支持</td>
<td>-</td>
</tr>
<tr>
<td>适用场景</td>
<td>大中小文件</td>
<td>大中小文件</td>
<td>大中文件</td>
<td>中小文件</td>
<td>大中小文件</td>
<td>大中小文件</td>
</tr>
</tbody></table>
<p>对比了 Github 的 Star，MinIO 增长的很快，而且官方还有中文文档提供，中小企业使用不错</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zengjunjie1026.github.io/2023/08/16/redis%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="andrew">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="分子美食家的博客">
      <meta itemprop="description" content="做自己爱做的事，爱自己在做的事！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 分子美食家的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/16/redis%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">redis分布式安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-16 17:59:33" itemprop="dateCreated datePublished" datetime="2023-08-16T17:59:33+08:00">2023-08-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-18 17:25:20" itemprop="dateModified" datetime="2023-08-18T17:25:20+08:00">2023-08-18</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>python 操作redis</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="comment">#   连接redis</span></span><br><span class="line"><span class="comment">#   几个常用默认参数：</span></span><br><span class="line"><span class="comment">#   host=&#x27;localhost&#x27;, port=6379, db=0, decode_responses=False, password=None</span></span><br><span class="line">pool = redis.ConnectionPool(host=<span class="string">&#x27;ip-address&#x27;</span>, port=<span class="number">6379</span>, decode_responses=<span class="literal">True</span>,db=<span class="number">1</span>,password=<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---redis</span></span><br></pre></td></tr></table></figure>


<p>字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">r = redis.Redis(connection_pool=pool)</span><br><span class="line"><span class="comment">#   增加数据：set key value（如果key存在，则修改为新的value）</span></span><br><span class="line"><span class="built_in">print</span>(r.<span class="built_in">set</span>(<span class="string">&#x27;str_type&#x27;</span>, <span class="string">&#x27;str_value&#x27;</span>))  <span class="comment"># 打印True</span></span><br><span class="line"><span class="comment">#   追加数据：append key value</span></span><br><span class="line"><span class="built_in">print</span>(r.append(<span class="string">&#x27;str_type&#x27;</span>, <span class="string">&#x27;_new&#x27;</span>))  <span class="comment"># 打印13，字符长度</span></span><br><span class="line"><span class="comment">#   查看数据：get key</span></span><br><span class="line"><span class="built_in">print</span>(r.get(<span class="string">&#x27;str_type&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>数组</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#   在插入数据时，如果该键并不存在，Redis将为该键创建一个</span></span><br><span class="line"><span class="comment">#   在末尾添加数据（列表右边）</span></span><br><span class="line">r.rpush(<span class="string">&#x27;list_type&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;xy&#x27;</span>, <span class="string">&#x27;li_val_end&#x27;</span>)</span><br><span class="line"><span class="comment">#   在头部添加数据（列表左边）</span></span><br><span class="line">r.lpush(<span class="string">&#x27;list_type&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;xy&#x27;</span>, <span class="string">&#x27;li_val_start&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#   查看数据</span></span><br><span class="line"><span class="comment">#   数据为：[&#x27;li_val_start&#x27;, &#x27;xy&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;xy&#x27;, &#x27;li_val_end&#x27;]</span></span><br><span class="line"><span class="comment">#   下标范围：lrange key start stop</span></span><br><span class="line"><span class="built_in">print</span>(r.lrange(<span class="string">&#x27;list_type&#x27;</span>, <span class="number">0</span>, <span class="number">10</span>))</span><br><span class="line"><span class="comment">#   指定下标：lindex key index</span></span><br><span class="line"><span class="built_in">print</span>(r.lindex(<span class="string">&#x27;list_type&#x27;</span>, -<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#   删除数据</span></span><br><span class="line"><span class="comment">#   从末尾删除（列表右边）：rpop key</span></span><br><span class="line"><span class="built_in">print</span>(r.rpop(<span class="string">&#x27;list_type&#x27;</span>))  <span class="comment"># 打印删除的值</span></span><br><span class="line"><span class="comment">#   从头部删除（列表左边）：lpop key</span></span><br><span class="line"><span class="built_in">print</span>(r.lpop(<span class="string">&#x27;list_type&#x27;</span>))  <span class="comment"># 打印删除的值</span></span><br><span class="line"><span class="comment">#   指定值删除：lrem key count(可以存在多个重复的值，指定value删除的次数) value</span></span><br><span class="line"><span class="built_in">print</span>(r.lrem(<span class="string">&#x27;list_type&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;xy&#x27;</span>))  <span class="comment"># 打印成功删除的个数</span></span><br></pre></td></tr></table></figure>
<p>字典类型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   hash类型的值是一个键值对集合，如：h_test : &#123; field1:value1, field2:value2,...&#125;</span></span><br><span class="line"><span class="comment">#   添加数据：hset key field value</span></span><br><span class="line"><span class="built_in">print</span>(r.hset(<span class="string">&#x27;hash_type&#x27;</span>, <span class="string">&#x27;filed&#x27;</span>, <span class="string">&#x27;value&#x27;</span>))  <span class="comment"># 打印成功添加数据的条数</span></span><br><span class="line"><span class="comment">#   查看域值：hget key field</span></span><br><span class="line"><span class="built_in">print</span>(r.hget(<span class="string">&#x27;hash_type&#x27;</span>, <span class="string">&#x27;filed&#x27;</span>))</span><br><span class="line"><span class="comment">#   查看所有的field：hkeys key</span></span><br><span class="line"><span class="built_in">print</span>(r.hkeys(<span class="string">&#x27;hash_type&#x27;</span>))</span><br><span class="line"><span class="comment">#   查看所有的value：hvals key</span></span><br><span class="line"><span class="built_in">print</span>(r.hvals(<span class="string">&#x27;hash_type&#x27;</span>))</span><br><span class="line"><span class="comment">#   查看所有的键值对：hgetall key</span></span><br><span class="line"><span class="built_in">print</span>(r.hgetall(<span class="string">&#x27;hash_type&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h1 id="python-zset"><a href="#python-zset" class="headerlink" title="python zset"></a>python zset</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">conn=redis.StrictRedis(host=<span class="string">&#x27;192.168.80.41&#x27;</span>,port=<span class="number">6379</span>,db=<span class="number">0</span>)</span><br><span class="line">conn.zadd(<span class="string">&#x27;znames&#x27;</span>,<span class="number">100</span>,<span class="string">&#x27;jiang&#x27;</span>)</span><br><span class="line">conn.zadd(<span class="string">&#x27;znames&#x27;</span>,<span class="number">20</span>,<span class="string">&#x27;wolson&#x27;</span>)</span><br><span class="line">    <span class="comment">#向有顺集合中增加一个元素jiang、它的分值为100</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(conn.zscore(<span class="string">&#x27;znames&#x27;</span>,<span class="string">&#x27;jiang&#x27;</span>))</span><br><span class="line">    <span class="comment">#获取jiang这个元素的分值</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(conn.zrange(<span class="string">&#x27;znames&#x27;</span>,<span class="number">0</span>,-<span class="number">1</span>,desc=<span class="literal">True</span>,withscores=<span class="literal">True</span>))</span><br><span class="line">    <span class="comment">#获取集合中指定序列内的元素</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(conn.zrangebyscore(<span class="string">&#x27;znames&#x27;</span>,<span class="number">80</span>,<span class="number">100</span>))</span><br><span class="line">    <span class="comment">#获取指定分数范围内的元素</span></span><br><span class="line"></span><br><span class="line">newScore=conn.zincrby(<span class="string">&#x27;znames&#x27;</span>,<span class="string">&#x27;wolson&#x27;</span>,<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(newScore)</span><br><span class="line"><span class="built_in">print</span>(conn.zscore(<span class="string">&#x27;znames&#x27;</span>,<span class="string">&#x27;wolson&#x27;</span>))</span><br><span class="line">    <span class="comment">#增加指定元素的分值</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(conn.zcard(<span class="string">&#x27;znames&#x27;</span>))</span><br><span class="line">    <span class="comment">#获取集合中的元素数</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(conn.zcount(<span class="string">&#x27;znames&#x27;</span>,<span class="number">90</span>,<span class="number">101</span>))</span><br><span class="line">    <span class="comment">#获取分数范围内的元素数量</span></span><br><span class="line"></span><br><span class="line">conn.zrem(<span class="string">&#x27;znames&#x27;</span>,<span class="string">&#x27;wolson&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(conn.zrange(<span class="string">&#x27;znames&#x27;</span>,<span class="number">0</span>,-<span class="number">1</span>))</span><br><span class="line">    <span class="comment">#删除集合中指定元素</span></span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zengjunjie1026.github.io/2023/08/16/mongodb-%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="andrew">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="分子美食家的博客">
      <meta itemprop="description" content="做自己爱做的事，爱自己在做的事！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 分子美食家的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/16/mongodb-%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">mongodb 分布式安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-16 17:59:17" itemprop="dateCreated datePublished" datetime="2023-08-16T17:59:17+08:00">2023-08-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-22 07:24:07" itemprop="dateModified" datetime="2023-08-22T07:24:07+08:00">2023-08-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>参考搭建文档<a target="_blank" rel="noopener" href="https://blog.csdn.net/msh6453/article/details/131161845">https://blog.csdn.net/msh6453/article/details/131161845</a></p>
<p>前言<br>官方文档：<a target="_blank" rel="noopener" href="https://www.mongodb.com/docs/%EF%BC%88%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83%EF%BC%89">https://www.mongodb.com/docs/（可以参考）</a></p>
<h2 id="一，安装说明"><a href="#一，安装说明" class="headerlink" title="一，安装说明"></a>一，安装说明</h2><p>1.1环境说明<br>1、首先确定部署的环境，确定下服务器的端口，一般默认是22的端口；<br>2、操作系统Centos7.9；<br>3、 数据库mongodb-linux-x86_64-rhel70-4.4.22。<br>mongodb版本4.4.22</p>
<p><img src="/image-1.png" alt="Alt text"></p>
<p>mongos，数据库集群请求的入口，所有的请求都通过mongos进行协调，不需要在应用程序添加一个路由选择器，mongos自己就是一个请求分发中心，它负责把对应的数据请求请求转发到对应的shard服务器上。在生产环境通常有多mongos作为请求的入口，防止其中一个挂掉所有的mongodb请求都没有办法操作。</p>
<p>config server，顾名思义为配置服务器，存储所有数据库元信息（路由、分片）的配置。mongos本身没有物理存储分片服务器和数据路由信息，只是缓存在内存里，配置服务器则实际存储这些数据。mongos第一次启动或者关掉重启就会从 config server 加载配置信息，以后如果配置服务器信息变化会通知到所有的 mongos 更新自己的状态，这样 mongos 就能继续准确路由。在生产环境通常有多个 config server 配置服务器，因为它存储了分片路由的元数据，防止数据丢失！</p>
<p>shard，分片（sharding）是指将数据库拆分，将其分散在不同的机器上的过程。将数据分散到不同的机器上，不需要功能强大的服务器就可以存储更多的数据和处理更大的负载。基本思想就是将集合切成小块，这些块分散到若干片里，每个片只负责总数据的一部分，最后通过一个均衡器来对各个分片进行均衡（数据迁移）。</p>
<p>replica set，中文翻译副本集，其实就是shard的备份，防止shard挂掉之后数据丢失。复制提供了数据的冗余备份，并在多个服务器上存储数据副本，提高了数据的可用性， 并可以保证数据的安全性。</p>
<p>仲裁者（Arbiter），是复制集中的一个MongoDB实例，它并不保存数据。仲裁节点使用最小的资源并且不要求硬件设备，不能将Arbiter部署在同一个数据集节点中，可以部署在其他应用服务器或者监视服务器中，也可部署在单独的虚拟机中。为了确保复制集中有奇数的投票成员（包括primary），需要添加仲裁节点做为投票，否则primary不能运行时不会自动切换primary。</p>
<p>简单了解之后，我们可以这样总结一下，应用请求mongos来操作mongodb的增删改查，配置服务器存储数据库元信息，并且和mongos做同步，数据最终存入在shard（分片）上，为了防止数据丢失同步在副本集中存储了一份，仲裁在数据存储到分片的时候决定存储到哪个节点。</p>
<table>
<thead>
<tr>
<th>服务器</th>
<th>ceph-node-1</th>
<th>ceph-node-2</th>
<th>ceph-node-3</th>
</tr>
</thead>
<tbody><tr>
<td>ip</td>
<td>10.30.0.48</td>
<td>10.30.0.49</td>
<td>10.30.0.50</td>
</tr>
<tr>
<td>server-route</td>
<td>mongos</td>
<td>mongos</td>
<td>mongos</td>
</tr>
<tr>
<td>server-config</td>
<td>config server</td>
<td>config server</td>
<td>config server</td>
</tr>
<tr>
<td>server-config</td>
<td>shard server1 主节点</td>
<td>shard server1 副节点</td>
<td>shard server1 仲裁</td>
</tr>
<tr>
<td>server-config</td>
<td>shard server2 仲裁</td>
<td>shard server2 主节点</td>
<td>shard server2 副节点</td>
</tr>
<tr>
<td>server-config</td>
<td>shard server3 副节点</td>
<td>shard server3 仲裁</td>
<td>shard server3 主节点</td>
</tr>
</tbody></table>
<h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /opt/mongo/MongoDB/conf</span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/mongo/MongoDB/server</span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/mongo/MongoDB/mongos/log</span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/mongo/MongoDB/config/data</span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/mongo/MongoDB/config/log</span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/mongo/MongoDB/shard1/data</span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/mongo/MongoDB/shard1/log</span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/mongo/MongoDB/shard2/data</span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/mongo/MongoDB/shard2/log</span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/mongo/MongoDB/shard3/data</span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/mongo/MongoDB/shard3/log</span><br><span class="line"></span><br><span class="line">wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.22.tgz</span><br><span class="line">tar -xvzf mongodb-linux-x86_64-rhel70-4.4.22.tgz -C /opt/mongo/MongoDB/server/</span><br><span class="line"><span class="built_in">mv</span> /opt/mongo/MongoDB/server/mongodb-linux-x86_64-rhel70-4.4.22 /opt/mongo/MongoDB/server/mongodb</span><br><span class="line"></span><br><span class="line">vim /etc/profile</span><br><span class="line"><span class="built_in">export</span> MONGODB_HOME=/opt/mongo/MongoDB/server/mongodb</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$MONGODB_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line">:wq!</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">vim /opt/mongo/MongoDB/conf/config.conf </span><br><span class="line">vim /opt/mongo/MongoDB/conf/shard1.conf</span><br><span class="line">vim /opt/mongo/MongoDB/conf/shard2.conf</span><br><span class="line">vim /opt/mongo/MongoDB/conf/shard3.conf</span><br><span class="line">vim /opt/mongo/MongoDB/conf/mongos.conf</span><br></pre></td></tr></table></figure>

<p>配置文件如mongo&#x2F;conf 下面<br>注意安装的时候不要设置最后的安全密钥，待完毕后添加</p>
<p>启动服务顺序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mongod -f /opt/mongo/MongoDB/conf/config.conf</span><br><span class="line">mongod -f /opt/mongo/MongoDB/conf/shard1.conf</span><br><span class="line">mongod -f /opt/mongo/MongoDB/conf/shard2.conf</span><br><span class="line">mongod -f /opt/mongo/MongoDB/conf/shard3.conf</span><br><span class="line">mongos -f /opt/mongo/MongoDB/conf/mongos.conf</span><br></pre></td></tr></table></figure>



<p>随便登入一台</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mongo 10.30.0.48:21000</span><br><span class="line">use admin</span><br><span class="line">config = &#123;_id : &quot;config&quot;,members : [&#123;_id : 0, host : &quot;10.30.0.48:21000&quot; &#125;,</span><br><span class="line">&#123;_id : 1, host : &quot;10.30.0.49:21000&quot; &#125;,&#123;_id : 2, host : &quot;10.30.0.50:21000&quot; &#125;]&#125;</span><br><span class="line">rs.initiate(config)</span><br></pre></td></tr></table></figure>


<p>同理 server sharded1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mongo 10.30.0.48:27001</span><br><span class="line">use admin</span><br><span class="line">config = &#123; _id : &quot;shard1&quot;,members : [&#123;_id : 0, host : &quot;10.30.0.48:27001&quot; ,priority: 2 &#125;,&#123;_id : 1, host : &quot;10.30.0.49:27001&quot; ,priority: 1 &#125;,&#123;_id : 2, host : &quot;10.30.0.50:27001&quot;,arbiterOnly: true&#125;]&#125;</span><br><span class="line">//(“priority”优先级，数字越大，优先等级越高；“arbiterOnly”冲裁节点；冲裁节点根据优先等级判断哪个节点作为主节点)</span><br><span class="line">rs.initiate(config)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mongo 10.30.0.48:27002</span><br><span class="line">server shard2</span><br><span class="line">use admin</span><br><span class="line">config = &#123; _id : <span class="string">&quot;shard2&quot;</span>,members : [&#123;_id : 0, host : <span class="string">&quot;10.30.0.48:27002&quot;</span> ,arbiterOnly: <span class="literal">true</span> &#125;,</span><br><span class="line">&#123;_id : 1, host : <span class="string">&quot;10.30.0.49:27002&quot;</span> ,priority: 2 &#125;,&#123;_id : 2, host : <span class="string">&quot;10.30.0.50:27002&quot;</span>,priority: 1&#125;]&#125;</span><br><span class="line">rs.initiate(config)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>server shard3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mongo 10.30.0.48:27003</span><br><span class="line">use admin</span><br><span class="line">config = &#123; _id : &quot;shard3&quot;,members : [&#123;_id : 0, host : &quot;10.30.0.48:27003&quot; ,priority: 1 &#125;,</span><br><span class="line"></span><br><span class="line">&#123;_id : 1, host : &quot;10.30.0.49:27003&quot; ,arbiterOnly: true &#125;,&#123;_id : 2, host : &quot;10.30.0.50:27003&quot;,priority: 2&#125;]&#125;</span><br><span class="line"></span><br><span class="line">rs.initiate(config)</span><br></pre></td></tr></table></figure>



<p>添加分片服务器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br><span class="line">sh.addShard(<span class="string">&quot;shard1/10.30.0.48:27001,10.30.0.49:27001,10.30.0.50:27001&quot;</span>)</span><br><span class="line"></span><br><span class="line">sh.addShard(<span class="string">&quot;shard2/10.30.0.48:27002,10.30.0.49:27002,10.30.0.50:27002&quot;</span>)</span><br><span class="line"></span><br><span class="line">sh.addShard(<span class="string">&quot;shard3/10.30.0.48:27003,10.30.0.49:27003,10.30.0.50:27003&quot;</span>)</span><br><span class="line"></span><br><span class="line">sh.status()</span><br></pre></td></tr></table></figure>


<p>创建用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">执行命令： mongo -port 20000</span><br><span class="line">执行命令： use admin//这个条件是必须的</span><br><span class="line">执行命令：db.createUser(</span><br><span class="line">  &#123;     user:<span class="string">&quot;ml_grp&quot;</span>,</span><br><span class="line">        <span class="built_in">pwd</span>:<span class="string">&quot;passwd&quot;</span>,</span><br><span class="line">        roles:[&#123;role:<span class="string">&quot;root&quot;</span>,db:<span class="string">&quot;admin&quot;</span>&#125;]</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>use admin<br>执行命令：db.auth(‘ml_grp’,’passwd’)<br>执行命令：db.runCommand( { enablesharding :”zjxndc”});&#x2F;&#x2F;为zjxndc开启分片功能<br>执行命令：db.runCommand( { shardcollection : “zjxndc.measureHisvalues”,key : {_id: 1} } )&#x2F;</p>
<p>use config<br>db.settings.save({“_id”:”chunksize”,”value”:1})<br>use zjxndc<br>d、执行命令：for (var i &#x3D; 1; i &lt;&#x3D; 100000; i++){</p>
<p>db.measureHisvalues.insert({“_id”:i,”test1”:”testval1”+i});</p>
<p>}</p>
<p><img src="/1408af41c022dc62726ecf884c95ff0a.png" alt="enable partition"><br><img src="/image.png" alt="查看是否分区成功"></p>
<h3 id="配置安全"><a href="#配置安全" class="headerlink" title="配置安全"></a>配置安全</h3><h4 id="4-1-安全验证设置用户"><a href="#4-1-安全验证设置用户" class="headerlink" title="4.1 安全验证设置用户"></a>4.1 安全验证设置用户</h4><p>1、副本集和共享集群的各个节点成员之间使用内部身份验证，可以使用密钥文件或x.509证书。密钥文件比较简单，官方推荐如果是测试环境可以使用密钥文件，但是正是环境，官方推荐x.509证书。原理就是，集群中每一个实例彼此连接的时候都检验彼此使用的证书的内容是否相同。只有证书相同的实例彼此才可以访问。使用客户端连接到mongodb集群时，开启访问授权。对于集群外部的访问。如通过可视化客户端，或者通过代码连接的时候，需要开启授权。<br>a、生成密钥文件，在keyfile身份验证中，副本集中的每个mongod实例都使用keyfile的内容作为共享密码，只有具有正确密钥文件的mongod或者mongos实例可以连接到副本集。密钥文件的内容必须在6到1024个字符之间，并且在unix&#x2F;linux系统中文件所有者必须有对文件至少有读的权限。可以用任何方式生成密钥文件例如：(任意一台机器即可)</p>
<p>执行命令：openssl rand -base64 756 &gt; &#x2F;opt&#x2F;mongo&#x2F;MongoDB&#x2F;testKeyFile.file &#x2F;&#x2F;生成密钥</p>
<p>执行命令：chmod 400 &#x2F;opt&#x2F;mongo&#x2F;MongoDB&#x2F;testKeyFile.file &#x2F;&#x2F;赋予权限</p>
<p>执行命令：scp -P22 &#x2F;opt&#x2F;mongo&#x2F;MongoDB&#x2F;testKeyFile.file <a href="mailto:&#114;&#x6f;&#111;&#x74;&#64;&#x31;&#x30;&#x2e;&#x33;&#48;&#x2e;&#48;&#x2e;&#x34;&#x39;">&#114;&#x6f;&#111;&#x74;&#64;&#x31;&#x30;&#x2e;&#x33;&#48;&#x2e;&#48;&#x2e;&#x34;&#x39;</a>:&#x2F;opt&#x2F;mongo&#x2F;MongoDB &#x2F;&#x2F;拷贝至其他0.55服务器上（“-P22”是端口，根据实际情况来）</p>
<p>执行命令：scp -P22 &#x2F;opt&#x2F;mongo&#x2F;MongoDB&#x2F;testKeyFile.file root@:10.30.0.49 &#x2F;opt&#x2F;mongo&#x2F;MongoDB &#x2F;&#x2F;拷贝至其他0.56服务器上</p>
<p>创建用户成功后，关闭所有的节点（三台机都需要操作）</p>
<p>执行命令：按照先后顺序来处理关闭，mongos&gt;config&gt;shadr3&gt;shadr2&gt;shadr1</p>
<p>&#x2F;&#x2F;注意的是每一个服务的关闭都需要在三台机上关闭，在关闭其他服务。例如关闭shadr3服务，先关闭0.54服务器上的shadr3服务，其次0.55服务器上的shadr3服务，再是0.56服务器上的shadr3服务；然后在关闭shadr2服务，也是按照这个顺序处理。（这个地方主要新手操作避免出错）</p>
<p>执行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mongod -f /opt/mongo/MongoDB/conf/shard1.conf --shutdown</span><br><span class="line">mongod -f /opt/mongo/MongoDB/conf/shard2.conf --shutdown</span><br><span class="line">mongod -f /opt/mongo/MongoDB/conf/shard3.conf --shutdown</span><br><span class="line">mongod -f /opt/mongo/MongoDB/conf/config.conf --shutdown</span><br><span class="line">mongo 10.30.0.48:20000//mongos需要这样关闭，用上面的命令有问题。</span><br><span class="line"></span><br><span class="line">use admin</span><br><span class="line">db.auth(<span class="string">&#x27;ml_grp&#x27;</span>,<span class="string">&#x27;passwd&#x27;</span>)</span><br><span class="line">db.shutdownServer()</span><br></pre></td></tr></table></figure>

<p>3、配置testKeyFile.file，依次在每台机器上的mongos.conf、config.conf、shard1.conf、shard2.conf、shard3.conf的配置和开启授权验证。<br>a、先是config.conf、shard1.conf、shard2.conf、shard3.conf的配置和开启授权验证。（三台机器的这些文件都需要添加）<br>在conf这几个文件的的最后添加：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  keyFile: /opt/mongo/MongoDB/testKeyFile.file</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure>
<p>b、然后在三台机器的mongos.conf配置文件中最后添加：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  keyFile: /opt/mongo/MongoDB/testKeyFile.file</span><br></pre></td></tr></table></figure>
<p>&#x2F;&#x2F;这里就说明了testKeyFile.file最好在每台机器放在一个位置，为了后面复制粘贴处理</p>
<p>&#x2F;&#x2F;解释说明： mongos比mongod少了authorization：enabled的配置。原因是，副本集加分片的安全认证需要配置两方面的，副本集各个节点之间使用内部身份验证，用于内部各个mongo实例的通信，只有相同keyfile才能相互访问。所以都要开启keyFile: &#x2F;data&#x2F;mongodb&#x2F;testKeyFile.file</p>
<pre><code>然而对于所有的mongod，才是真正的保存数据的分片。mongos只做路由，不保存数据。所以所有的mongod开启访问数据的授权authorization:enabled。这样用户只有账号密码正确才能访问到数据
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zengjunjie1026.github.io/2023/08/16/fedora-k8s-%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="andrew">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="分子美食家的博客">
      <meta itemprop="description" content="做自己爱做的事，爱自己在做的事！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 分子美食家的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/16/fedora-k8s-%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">fedora k8s 安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-16 17:58:56" itemprop="dateCreated datePublished" datetime="2023-08-16T17:58:56+08:00">2023-08-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/10/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/12/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">andrew</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
